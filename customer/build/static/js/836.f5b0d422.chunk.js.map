{"version":3,"file":"static/js/836.f5b0d422.chunk.js","mappings":"0MAKA,SAASA,EAAUC,GAEjB,MAAO,OADKC,OAAOD,GAAK,GACJE,eAAe,QAAS,CAAEC,sBAAuB,GACvE,CAEOC,eAAeC,EAAmBC,GACvC,IAAK,IAADC,EAAAC,EAAAC,EAAAC,EAAAC,EACF,MAAMC,EAAM,IAAIC,EAAAA,QAAM,CAAEC,KAAM,KAAMC,OAAQ,OACtCC,EAAa,GACnB,IAAIC,EAAI,GAGRL,EAAIM,QAAQ,YAAa,QACzBN,EAAIO,YAAY,IAChBP,EAAIQ,KAAK,2BAA4BJ,EAAYC,GAEjDA,GAAK,GACLL,EAAIM,QAAQ,YAAa,UACzBN,EAAIO,YAAY,IAChBP,EAAIQ,KAAK,aAADC,OAAcf,EAAMgB,SAAWN,EAAYC,GACnDL,EAAIQ,KAAK,SAADC,OAAUf,EAAMiB,YAAa,IAAIC,MAAOtB,kBAAoBc,EAAa,IAAKC,GAGtFA,GAAK,GACLL,EAAIO,YAAY,IAChBP,EAAIM,QAAQ,YAAa,QACzBN,EAAIQ,KAAK,oBAAqBJ,EAAYC,GAE1CL,EAAIM,QAAQ,YAAa,UACzBN,EAAIO,YAAY,IAChBF,GAAK,GAAIL,EAAIQ,KAAK,SAADC,QAAwB,QAAdd,EAAAD,EAAMmB,gBAAQ,IAAAlB,OAAA,EAAdA,EAAgBmB,OAAQ,IAAMV,EAAYC,GACrEA,GAAK,GAAIL,EAAIQ,KAAK,UAADC,QAAyB,QAAdb,EAAAF,EAAMmB,gBAAQ,IAAAjB,OAAA,EAAdA,EAAgBmB,QAAS,IAAMX,EAAYC,GACvEA,GAAK,GAAIL,EAAIQ,KAAK,aAADC,QAA4B,QAAdZ,EAAAH,EAAMmB,gBAAQ,IAAAhB,OAAA,EAAdA,EAAgBmB,WAAY,IAAMZ,EAAYC,GAC7EA,GAAK,GAAIL,EAAIQ,KAAK,YAADC,QAA2B,QAAdX,EAAAJ,EAAMmB,gBAAQ,IAAAf,OAAA,EAAdA,EAAgBmB,UAAW,IAAMb,EAAYC,GAG3E,MAAMa,GAAaxB,EAAMyB,OAAS,IAAIC,IAAKC,GAAO,CAChDA,EAAGC,MAAQD,EAAGE,QAAO,WAAAd,OAASY,EAAGE,SAAY,IAC7CC,OAAOH,EAAGI,KACVtC,EAAUkC,EAAGK,OACbvC,GAAWkC,EAAGI,KAAO,IAAMJ,EAAGK,OAAS,MAGzCC,IAAU3B,EAAK,CACb4B,OAAQvB,EAAI,GACZwB,KAAM,CAAC,CAAC,OAAQ,MAAO,aAAc,UACrCC,KAAMZ,EACNa,MAAO,UACPC,OAAQ,CAAEC,KAAM,YAAaC,SAAU,GAAIC,OAAQ,UACnDC,WAAY,CAAEC,UAAW,CAAC,GAAI,IAAK,KAAMC,UAAW,IAAKC,UAAW,QACpEC,aAAc,CACZ,EAAG,CAAEL,OAAQ,QACb,EAAG,CAAEA,OAAQ,UACb,EAAG,CAAEA,OAAQ,SACb,EAAG,CAAEA,OAAQ,YAIjB,MAAMM,GAA0B,QAAjB1C,EAAAC,EAAI0C,qBAAa,IAAA3C,OAAA,EAAjBA,EAAmB0C,SAAWpC,EAAI,GAGjDL,EAAIO,YAAY,IAChBP,EAAIM,QAAQ,YAAa,QACzBN,EAAI2C,aAAa,IAAK,EAAG,GACzB3C,EAAIQ,KAAK,gBAADC,OACUtB,EAAUO,EAAMkD,UAAY,IAC5CxC,EACAqC,EAAS,IAIXzC,EAAIO,YAAY,IAChBP,EAAIM,QAAQ,YAAa,UACzBN,EAAI2C,aAAa,GAAI,GAAI,IACzB3C,EAAIQ,KAAK,gDAAiDJ,EAAYqC,EAAS,IAE/EzC,EAAI2C,aAAa,EAAG,EAAG,KACvB3C,EAAIM,QAAQ,YAAa,UACzBN,EAAIQ,KAAK,8BAA+BJ,EAAYqC,EAAS,IAE7DzC,EAAI2C,aAAa,EAAG,IAAK,GACzB3C,EAAI6C,aAAa,uBAAwBzC,EAAYqC,EAAS,IAAK,CACjEK,IAAK,+BAEP9C,EAAI6C,aAAa,uBAAwBzC,EAAYqC,EAAS,IAAK,CACjEK,IAAK,+BAIP9C,EAAI+C,KAAK,WAADtC,OAAYf,EAAMgB,QAAO,SAGjC,MAAMsC,EAAUhD,EAAIiD,OAAO,eACrBC,EAAaC,KACjB,IAAIC,WAAWJ,GAASK,OAAO,CAACC,EAAMC,IAASD,EAAO9B,OAAOgC,aAAaD,GAAO,WAG7EE,MAAMC,EAAAA,GAAS,CACnBC,OAAQ,OACRC,QAAS,CAAE,eAAgB,qCAC3B9B,KACE,WACA+B,mBACEC,KAAKC,UAAU,CACbC,OAAQ,gBACRtD,QAAShB,EAAMgB,QACfuD,WAAYf,MAItB,CAAE,MAAOgB,GACPC,QAAQC,MAAM,+BAAgCF,GAC9CG,MAAM,sDACR,CACF,C","sources":["shared/invoice.js"],"sourcesContent":["import jsPDF from \"jspdf\";\r\nimport autoTable from \"jspdf-autotable\";\r\nimport { API_URL } from \"./api\";\r\n\r\n// Format INR cleanly\r\nfunction formatINR(n) {\r\n  const num = Number(n || 0);\r\n  return \"Rs. \" + num.toLocaleString(\"en-IN\", { minimumFractionDigits: 2 });\r\n}\r\n\r\nexport async function downloadPdfInvoice(order) {\r\n  try {\r\n    const doc = new jsPDF({ unit: \"pt\", format: \"a4\" });\r\n    const marginLeft = 40;\r\n    let y = 40;\r\n\r\n    // Title\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.setFontSize(18);\r\n    doc.text(\"Diwali Fireworks Invoice\", marginLeft, y);\r\n\r\n    y += 25;\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.setFontSize(11);\r\n    doc.text(`Order ID: ${order.orderId}`, marginLeft, y);\r\n    doc.text(`Date: ${order.createdAt || new Date().toLocaleString()}`, marginLeft + 300, y);\r\n\r\n    // Customer Info\r\n    y += 25;\r\n    doc.setFontSize(12);\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.text(\"Customer Details:\", marginLeft, y);\r\n\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.setFontSize(11);\r\n    y += 15; doc.text(`Name: ${order.customer?.name || \"\"}`, marginLeft, y);\r\n    y += 15; doc.text(`Phone: ${order.customer?.phone || \"\"}`, marginLeft, y);\r\n    y += 15; doc.text(`WhatsApp: ${order.customer?.whatsapp || \"\"}`, marginLeft, y);\r\n    y += 15; doc.text(`Address: ${order.customer?.address || \"\"}`, marginLeft, y);\r\n\r\n    // Items Table\r\n    const tableBody = (order.items || []).map((it) => [\r\n      it.item + (it.subItem ? ` — ${it.subItem}` : \"\"),\r\n      String(it.qty),\r\n      formatINR(it.price),\r\n      formatINR((it.qty || 0) * (it.price || 0)),\r\n    ]);\r\n\r\n    autoTable(doc, {\r\n      startY: y + 20,\r\n      head: [[\"Item\", \"Qty\", \"Unit Price\", \"Total\"]],\r\n      body: tableBody,\r\n      theme: \"striped\",\r\n      styles: { font: \"helvetica\", fontSize: 10, halign: \"center\" },\r\n      headStyles: { fillColor: [25, 118, 210], textColor: 255, fontStyle: \"bold\" },\r\n      columnStyles: {\r\n        0: { halign: \"left\" },\r\n        1: { halign: \"center\" },\r\n        2: { halign: \"right\" },\r\n        3: { halign: \"right\" },\r\n      },\r\n    });\r\n\r\n    const finalY = doc.lastAutoTable?.finalY || (y + 40);\r\n\r\n    // Grand Total\r\n    doc.setFontSize(13);\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.setTextColor(200, 0, 0);\r\n    doc.text(\r\n      `Grand Total: ${formatINR(order.subtotal || 0)}`,\r\n      marginLeft,\r\n      finalY + 30\r\n    );\r\n\r\n    // Footer\r\n    doc.setFontSize(11);\r\n    doc.setFont(\"helvetica\", \"italic\");\r\n    doc.setTextColor(80, 80, 80);\r\n    doc.text(\"Thank you for shopping with Diwali Fireworks!\", marginLeft, finalY + 60);\r\n\r\n    doc.setTextColor(0, 0, 150);\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.text(\"Contact us for any queries:\", marginLeft, finalY + 85);\r\n\r\n    doc.setTextColor(0, 102, 0);\r\n    doc.textWithLink(\"WhatsApp: 9494496494\", marginLeft, finalY + 105, {\r\n      url: \"https://wa.me/919494496494\",\r\n    });\r\n    doc.textWithLink(\"WhatsApp: 6302400271\", marginLeft, finalY + 125, {\r\n      url: \"https://wa.me/916302400271\",\r\n    });\r\n\r\n    // ✅ Save locally\r\n    doc.save(`invoice-${order.orderId}.pdf`);\r\n\r\n    // ✅ Upload to Google Apps Script\r\n    const pdfBlob = doc.output(\"arraybuffer\");\r\n    const base64File = btoa(\r\n      new Uint8Array(pdfBlob).reduce((data, byte) => data + String.fromCharCode(byte), \"\")\r\n    );\r\n\r\n    await fetch(API_URL, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n      body:\r\n        \"payload=\" +\r\n        encodeURIComponent(\r\n          JSON.stringify({\r\n            action: \"uploadInvoice\",\r\n            orderId: order.orderId,\r\n            fileBase64: base64File,\r\n          })\r\n        ),\r\n    });\r\n  } catch (err) {\r\n    console.error(\"PDF generation/upload error:\", err);\r\n    alert(\"⚠️ Could not generate/upload PDF invoice.\");\r\n  }\r\n}\r\n"],"names":["formatINR","n","Number","toLocaleString","minimumFractionDigits","async","downloadPdfInvoice","order","_order$customer","_order$customer2","_order$customer3","_order$customer4","_doc$lastAutoTable","doc","jsPDF","unit","format","marginLeft","y","setFont","setFontSize","text","concat","orderId","createdAt","Date","customer","name","phone","whatsapp","address","tableBody","items","map","it","item","subItem","String","qty","price","autoTable","startY","head","body","theme","styles","font","fontSize","halign","headStyles","fillColor","textColor","fontStyle","columnStyles","finalY","lastAutoTable","setTextColor","subtotal","textWithLink","url","save","pdfBlob","output","base64File","btoa","Uint8Array","reduce","data","byte","fromCharCode","fetch","API_URL","method","headers","encodeURIComponent","JSON","stringify","action","fileBase64","err","console","error","alert"],"sourceRoot":""}